<div class="container mt-4 animate__animated animate__fadeIn">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-secondary">Schedule</h2>
    <div>
      <button class="btn btn-sm btn-outline-secondary me-2" (click)="loadSessions()">Refresh</button>
      <button class="btn btn-primary-custom" (click)="toggleForm()">
        <i class="bi" [ngClass]="showForm ? 'bi-x-lg' : 'bi-plus-lg'"></i>
        {{ showForm ? 'Close' : 'Add Session' }}
      </button>
    </div>
  </div>

  <div *ngIf="showForm" class="card border-0 shadow-sm rounded-4 mb-4 bg-light">
    <div class="card-body p-4">
      <form (ngSubmit)="addSession()">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="fw-bold small">Date</label>
            <input type="date" class="form-control" [(ngModel)]="newSession.date" name="date" required>
          </div>
          <div class="col-md-3">
            <label class="fw-bold small">Start Time</label>
            <input type="time" class="form-control" [(ngModel)]="newSession.timeStart" name="timeStart" required>
          </div>
          <div class="col-md-3">
            <label class="fw-bold small">End Time</label>
            <input type="time" class="form-control" [(ngModel)]="newSession.timeEnd" name="timeEnd">
          </div>
          <div class="col-md-3">
            <label class="fw-bold small">Type</label>
            <select class="form-select" [(ngModel)]="newSession.type" name="type">
              <option>Keynote</option><option>Workshop</option><option>Panel</option>
            </select>
          </div>
          <div class="col-md-6">
            <input type="text" class="form-control" [(ngModel)]="newSession.title" name="title" placeholder="Title" required>
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" [(ngModel)]="newSession.speaker" name="speaker" placeholder="Speaker">
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" [(ngModel)]="newSession.venue" name="venue" placeholder="Venue">
          </div>
          <div class="col-12 text-end">
            <button type="submit" class="btn btn-success text-white">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="days.length > 0 && filteredSessions.length === 0" class="alert alert-danger">
    Data loaded, but filter hidden it. Selected Day: {{ selectedDay }}
  </div>

  <ul class="nav nav-pills mb-4 gap-2">
    <li class="nav-item" *ngFor="let day of days">
      <button class="nav-link rounded-pill px-4"
              [class.active]="selectedDay === day"
              [class.bg-white]="selectedDay !== day"
              (click)="selectDay(day)">
        {{ day | date:'mediumDate' }}
      </button>
    </li>
  </ul>

  <div *ngIf="days.length === 0" class="alert alert-warning text-center">
    No sessions found. <br>
    <small class="text-muted">Check console logs to see if backend sent data.</small>
  </div>

  <div class="row g-3">
    <div class="col-12" *ngFor="let session of filteredSessions">
      <div class="card border-0 shadow-sm rounded-4 hover-card">
        <div class="card-body p-3">
          <div class="row align-items-center">
            <div class="col-md-2 border-end text-center">
              <h5 class="mb-0 fw-bold">{{ session.timeStart }}</h5>
              <small class="text-muted">{{ session.timeEnd }}</small>
            </div>
            <div class="col-md-8 ps-md-4">
              <div class="d-flex align-items-center mb-1">
                <span class="badge bg-primary rounded-pill me-2">{{ session.type }}</span>
                <span class="text-muted small"><i class="bi bi-geo-alt-fill me-1"></i>{{ session.venue }}</span>
              </div>
              <h5 class="fw-bold mb-1">{{ session.title }}</h5>
              <p class="text-muted small mb-0">{{ session.speaker }}</p>
            </div>
            <div class="col-md-2 text-end">
              <button class="btn btn-sm btn-outline-danger rounded-circle" (click)="deleteSession(session.id)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
