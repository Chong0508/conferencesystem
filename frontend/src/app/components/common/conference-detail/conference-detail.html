<div class="container mt-4 animate__animated animate__fadeIn" *ngIf="!isLoading && conference; else stateTemplates">
  
  <div class="mb-4">
    <a routerLink="/dashboard/conferences" class="btn btn-link text-decoration-none p-0 text-secondary hover-primary transition-all">
      <i class="bi bi-arrow-left-circle-fill fs-4 me-2"></i>
      <span class="fw-bold">Back to All Conferences</span>
    </a>
  </div>

  <div class="card border-0 shadow-lg rounded-4 overflow-hidden mb-4">
    <div class="bg-primary py-2" [ngStyle]="{'background': isConferenceClosed ? '#6c757d' : 'linear-gradient(90deg, #0d6efd 0%, #6610f2 100%)'}"></div>
    <div class="card-body p-4 p-md-5 bg-white">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="d-flex align-items-center mb-3">
            <span class="badge rounded-pill px-3 py-2 me-2 shadow-sm" [ngClass]="isConferenceClosed ? 'bg-secondary' : 'bg-primary'">
               {{ conference.acronym }}
            </span>
            <span *ngIf="isConferenceClosed" class="badge bg-danger rounded-pill px-3 py-2 shadow-sm me-2">CONFERENCE CLOSED</span>
            <span class="text-muted small fw-medium"><i class="bi bi-geo-alt-fill text-danger me-1"></i>{{ conference.location }}</span>
          </div>
          <h1 class="fw-bold text-dark display-5 mb-0">{{ conference.title }}</h1>
        </div>
        <div class="col-md-4 text-md-end mt-4 mt-md-0">
          <div class="p-3 bg-light rounded-4 border d-inline-block text-center shadow-sm">
            <p class="text-muted small mb-1 uppercase ls-1">Malaysia Date (MYT)</p>
            <h5 class="fw-bold text-primary mb-0">{{ conference.start_date }}</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-lg-8">
      
      <div class="card border-0 shadow-sm rounded-4 p-4 mb-4 bg-white">
        <h5 class="fw-bold mb-3 border-bottom pb-2 text-dark">Event Overview</h5>
        <p class="text-secondary leading-relaxed" style="white-space: pre-line;">{{ conference.description || 'No description provided.' }}</p>
      </div>

      <div class="card border-0 shadow-sm rounded-4 overflow-hidden bg-white">
        <div class="card-header bg-white p-3 border-bottom d-flex align-items-center">
           <i class="bi bi-calendar3 text-primary me-2"></i>
           <h6 class="fw-bold mb-0">Conference Schedule</h6>
        </div>
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h6 class="fw-bold mb-0 text-uppercase ls-1 small text-muted">Presentation Program</h6>
              <span class="badge bg-primary-subtle text-primary border rounded-pill px-3">
                {{ relatedPapers.length }} Papers Involved
              </span>
            </div>

            <div *ngIf="relatedPapers.length > 0; else noPapers">
              <div class="card border-0 shadow-sm rounded-4 mb-3 hover-card transition-all" *ngFor="let paper of relatedPapers">
                <div class="card-body p-3 d-flex align-items-center">
                  <div class="me-3 text-center border-end pe-3 d-flex flex-column justify-content-center" style="width: 80px;">
                    <i class="bi bi-file-earmark-text fs-3 text-primary"></i>
                    <small class="text-muted d-block" style="font-size: 0.65rem; font-weight: 800;">PAPER</small>
                  </div>
                  <div class="ps-2">
                    <h6 class="fw-bold mb-1 text-dark">{{ paper.title }}</h6>
                    <p class="small text-muted mb-0">
                      <i class="bi bi-person-circle me-1"></i>Presented by: <strong>{{ paper.submitterName }}</strong>
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <ng-template #noPapers>
              <div class="text-center py-5 border rounded-4 border-dashed bg-light">
                <i class="bi bi-calendar-x display-4 text-muted opacity-25 mb-2 d-block"></i>
                <p class="text-muted small">No paper presentations are currently listed for this meeting.</p>
              </div>
            </ng-template>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card border-0 shadow-lg rounded-4 bg-dark text-white mb-4 overflow-hidden">
        <div class="card-body p-4 text-center">
          <div class="bg-warning text-dark rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px;">
            <i class="bi bi-person-plus-fill fs-3"></i>
          </div>
          <h4 class="fw-bold mb-2">Registration</h4>
          <p class="small opacity-75 mb-4">Join as a Participant or Listener.</p>
          
          <div class="p-3 bg-white bg-opacity-10 rounded-4 mb-4 border border-white border-opacity-10">
            <label class="d-block small text-uppercase fw-bold opacity-50 mb-1">Status</label>
            <span class="fw-bold fs-5" [ngClass]="isConferenceClosed ? 'text-danger' : 'text-warning'">
               {{ isConferenceClosed ? 'Closed' : 'Active' }}
            </span>
          </div>

          <a [routerLink]="['/dashboard/conference-registration', conference.conference_id]" 
            class="btn btn-warning w-100 rounded-pill py-3 fw-bold shadow-sm transition-all hover-scale"
            [class.disabled]="isConferenceClosed">
            <i class="bi bi-pencil-square me-2"></i>
            {{ isConferenceClosed ? 'Registration Closed' : 'Register for Meeting' }}
          </a>
        </div>
      </div>

      <div class="card border-0 shadow-sm rounded-4 p-4 mb-4 bg-white">
        <h6 class="fw-bold text-muted text-uppercase mb-4 small ls-1">Critical Timeline</h6>
        <div class="mb-3 d-flex justify-content-between align-items-center border-bottom pb-2">
          <span class="small text-muted">Submissions</span>
          <span class="badge" [ngClass]="isConferenceClosed ? 'bg-danger-subtle text-danger' : 'bg-success-subtle text-success'">
            {{ isConferenceClosed ? 'Ended' : 'Open' }}
          </span>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <span class="small text-muted">Malaysia Time</span>
          <span class="small fw-bold text-primary">UTC+8</span>
        </div>
      </div>

      <div class="text-center p-3 border rounded-4 bg-white shadow-sm border-dashed">
        <p class="text-muted small mb-2">Participating as an Author?</p>
        <button [routerLink]="['/dashboard/submit-paper']" 
                [queryParams]="{ confId: conference.conference_id }"
                class="btn btn-outline-primary w-100 rounded-pill fw-bold btn-sm"
                [disabled]="isConferenceClosed">
          <i class="bi bi-file-earmark-plus me-1"></i>
          {{ isConferenceClosed ? 'Submissions Closed' : 'Submit Manuscript' }}
        </button>
      </div>

    </div>
  </div>
</div>

<ng-template #stateTemplates>
  <div *ngIf="isLoading" class="text-center py-5 animate__animated animate__fadeIn">
    <div class="spinner-grow text-primary" role="status"></div>
    <p class="text-muted mt-3">Loading conference dashboard...</p>
  </div>
  
  <div *ngIf="error" class="alert alert-danger rounded-4 p-4 mt-5 text-center shadow-sm max-w-500 mx-auto animate__animated animate__shakeX">
    <i class="bi bi-exclamation-triangle-fill fs-1 d-block mb-2"></i>
    <h5 class="fw-bold">{{ error }}</h5>
    <a routerLink="/dashboard/conferences" class="btn btn-danger mt-3 rounded-pill px-4 shadow-sm">
        Return to List
    </a>
  </div>
</ng-template>